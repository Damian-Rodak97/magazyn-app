@page "/login"
@inject IJSRuntime JS
@inject NavigationManager Navigation

<div class="login-container">
    <div class="login-box">
        <h3>üîí Logowanie do Magazynu</h3>
        
        @if (!string.IsNullOrEmpty(errorMessage))
        {
            <div class="alert alert-danger">
                @errorMessage
            </div>
        }
        
        <div class="mb-3">
            <label class="form-label">Login:</label>
            <input type="text" class="form-control" @bind="username" @onkeypress="HandleKeyPress" placeholder="Wpisz login" />
        </div>
        
        <div class="mb-3">
            <label class="form-label">Has≈Ço:</label>
            <input type="password" class="form-control" @bind="password" @onkeypress="HandleKeyPress" placeholder="Wpisz has≈Ço" />
        </div>
        
        <button class="btn btn-primary w-100" @onclick="HandleLogin">Zaloguj siƒô</button>
    </div>
</div>

<style>
    .login-container {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    
    .login-box {
        background: white;
        padding: 40px;
        border-radius: 10px;
        box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        width: 100%;
        max-width: 400px;
    }
    
    .login-box h3 {
        text-align: center;
        margin-bottom: 30px;
        color: #333;
    }
    
    .login-box .form-label {
        font-weight: 500;
        color: #555;
    }
    
    .login-box .btn {
        margin-top: 10px;
        padding: 12px;
        font-size: 1.1rem;
    }
</style>

@code {
    private string username = "";
    private string password = "";
    private string errorMessage = "";
    
    // Zahaszowane has≈Ço SHA256 dla "TRmagazyn123!"
    private const string HASHED_PASSWORD = "e5d9052c4f1e0599fd3eb948e78b6a79ffd53540880731115a57a89faf89e146";
    private const string VALID_USERNAME = "Tomasz";
    
    protected override async Task OnInitializedAsync()
    {
        // Sprawd≈∫ czy ju≈º zalogowany
        var isLogged = await JS.InvokeAsync<string>("localStorage.getItem", "isLoggedIn");
        if (isLogged == "true")
        {
            Navigation.NavigateTo("", false);
        }
    }
    
    private async Task HandleLogin()
    {
        errorMessage = "";
        
        if (string.IsNullOrWhiteSpace(username) || string.IsNullOrWhiteSpace(password))
        {
            errorMessage = "Wype≈Çnij wszystkie pola!";
            return;
        }
        
        // Sprawd≈∫ login
        if (username.Trim() != VALID_USERNAME)
        {
            errorMessage = "Nieprawid≈Çowy login lub has≈Ço!";
            await Task.Delay(1000); // Op√≥≈∫nienie dla bezpiecze≈Ñstwa
            return;
        }
        
        // Zahaszuj wprowadzone has≈Ço i por√≥wnaj
        var hashedInput = await HashPassword(password);
        
        if (hashedInput != HASHED_PASSWORD)
        {
            errorMessage = "Nieprawid≈Çowy login lub has≈Ço!";
            await Task.Delay(1000);
            return;
        }
        
        // Zalogowano pomy≈õlnie
        await JS.InvokeVoidAsync("localStorage.setItem", "isLoggedIn", "true");
        Navigation.NavigateTo("", false);
    }
    
    private async Task<string> HashPassword(string input)
    {
        // U≈ºyj SubtleCrypto API do hashowania
        return await JS.InvokeAsync<string>("hashPassword", input);
    }
    
    private async Task HandleKeyPress(KeyboardEventArgs e)
    {
        if (e.Key == "Enter")
        {
            await HandleLogin();
        }
    }
}
